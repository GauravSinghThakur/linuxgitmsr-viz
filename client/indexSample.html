<!DOCTYPE html>
<html data-ng-app="samples">
<head>
    <title>AngularJS Project for Visualizing Commit-Propagation into the Super-Repository of Linux</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="Content/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="Content/styles.css" rel="stylesheet" />
    <link href="Content/table.css" rel="stylesheet" />
    
    
</head>
<body ng-view>
    <h2>
        <img src="Content/images/angularShield.png" width="5%" height="5%"/>ngularJS Project: Visualizing Commit-Propagation --> The Super-Repository of Linux</h2>
    <div class="row">


        <!--<div class="span4 section">-->
        <!--    <h5>Mcidlinus Commits:</h5>-->
            <!--<ol> -->
                <!--<li ng-repeat="page in filtered = (pages |  filter:customfilter | orderBy:customsort)">-->
            <!--    <li ng-repeat="page in pages | filter:query">-->
            <!--        <a target="_blank" href="#/{{pages.indexOf(page)}}">{{page.mcidlinus}} {{page.comdate}} {{page.log}} </a>-->
                    <!--{{page}}-->
                    
            <!--    </li>-->
            <!--</ol>-->
        <!--</div>-->
        
        <div class="span8">
            <ng-include src="template"></ng-include>
            <!-- <div id="sampleContent"></div> -->
            <br />
            <div class="container">
                <h4>Search by: 
                    <select name="sel" style="width: 120px">
                        <option value="1">Commit ID</option>
                        <option value="2">Commit Date</option>
                        <option value="3">Commit Log</option>
                    </select>
                    <input ng-model="query" type="text"/>
                    
                        <label for="from">From:</label>
                        <input type="date" name="from"/>
                        <label for="to">To:</label>
                        <input type="date" name="to"/>
                    
                   
                </h4>
                <!--<textarea></textarea>-->
            </div>
        </div>
        
        <br><br><br>
        
        <div class="table-title">
            <h2>Commit List Linux Repo 2012</h2>
        </div>
        <table class="table-fill">
            <thead>
                <tr>
                    <th class="text-left">Commit ID</th>
                    <th class="text-left">Commit Date</th>
                    <th class="text-left">Commit Logs</th>
                </tr>
            </thead>
            <tbody class="table-hover">
                <tr ng-repeat ="page in pages | filter:query">
                    <td class="text-left"> <a target="_blank" href="#/{{pages.indexOf(page)}}">{{page.mcidlinus}} </a></td>
                    <td class="text-left">{{page.comdate | date:'medium'}} </td>
                    <td class="text-left">{{page.log}}</td>
                </tr>
                
            </tbody>
        </table>
    </div>

    <script src="Scripts/jquery.min.js"></script>
    <script src="Scripts/angular.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.2.10/angular-route.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    
    
    <script>
        // http://plnkr.co/edit/XklvXtc1AZpndjLvXrh8?p=preview
        //http://lepidllama.net/blog/how-to-push-an-existing-cloud9-project-to-github/
        //*****************APP*******************
        //var urlBase = '/DemoPartials/';
        var samplesModule = angular.module('samples', ['ngRoute']);

        // samplesModule.config(function($controllerProvider, $provide) {
        //     //Used to handle loading controllers dynamically
        //     samplesModule.controller = $controllerProvider.register;
        //     samplesModule.factory = $provide.factory;
        // });
        
        //*****************CONFIG*******************
        samplesModule.config(function($routeProvider) {
        $routeProvider.
          when('/', {
            templateUrl: 'index.html',
            controller: 'samplesController'
          }).
          when('/:commitId', {
            templateUrl: '/app/partials/commitInfo.html',
            controller: 'samplesController'
          }).
          otherwise({
            redirectTo: '/'
          });
      });
      
     

        //*****************CONTROLLER*******************
        samplesModule.controller('samplesController', function (commitsJson, $scope, $templateCache, $http, $location, $routeParams) {
            
            commitsJson.commits.success(function(cdata) {
                var z =0;
                var pages = [];
                var mwhen = [];
                var pid = [];
                while(cdata.commits[z]){
                    
                    pages.push({mcidlinus: cdata.commits[z].cid, comdate: new Date(cdata.commits[z].comdate), log: cdata.commits[z].log});
                    
                    /*
                    pages[z] = cdata.commits[z].mcidlinus;
                    mwhen[z] = new Date(cdata.commits[z].mwhen);
                    pid[z] = cdata.commits[z].id;
                    */
                    z++;
                }
                console.log(pages,mwhen,pid);
                 $scope.pages = pages;
                 $scope.mwhen = mwhen;
                 $scope.pid = pid;
                
            });
            
            $scope.commitId = $routeParams.commitId;
            
            Array.prototype.unique = function() {
                var a = [];
                for (var i=0, l=this.length; i<l; i++)
                    if (a.indexOf(this[i]) === -1)
                        a.push(this[i]);
                return a;
            };
                        
            commitsJson.commitInfo.success(function(data) {
                var mcid = [];
                mcid = data.commitInfo[$routeParams.commitId];
                var cid = [];
                var repo = [];
                var comdate = [];
                var mwhen = [];
                var mcidlinus = [];
                var mnextmerge = [];
                var mnext = [];
                var i = 0;
                var len = mcid.length-1;
                var repoOpp = [];
                
                while (mcid[i]){
                    mnextmerge[i] = mcid[i].mnextmerge;
                    mnext[i] = mcid[i].mnext;
                    cid[i]= mcid[i].cid;
                    repo[i] = mcid[i].repo;
                    comdate[i] = new Date(mcid[i].comdate);
                    if(i==0){
                        mcidlinus[0] = mcid[i].mcidlinus;
                        mwhen[0] = new Date(mcid[i].mwhen);
                    }
                    repoOpp[i] = mcid[len].repo;
                    len--;
                    i++;
                }
                
                cid[i] = mcidlinus[0];
                repo[i] = "linus/linus";
                comdate[i] = mwhen[0];
                var repos = repoOpp.unique().reverse();
                repos[repos.length] = "linus/linus";
                var comdates = comdate.unique();
                var merges = mnextmerge.unique();
                
                $scope.cid = cid;
                $scope.repo = repos;
                $scope.comdate = comdates;
                
                
                // var fields = Object.keys(mcid[0]);
                // var csv = mcid.map(function(row){
                //   return fields.map(function(fieldName){
                //     return JSON.stringify(row[fieldName] || '');
                //   });
                // });
                // csv.unshift(fields);
                
                
                $scope.tree = function (scope, element, attrs){
                    
                    // Variables
                    var svgWidth  = 400,
                        svgHeight = 400,    
                        originalCircle = [{"cx": "1357720800000", "cy": 5, "radius": 20},{"cx": "1457719600000", "cy": 10, "radius": 20}],
                        margin = {"top": 25, "right": 25, "bottom": 50, "left": 50},
                        width  = svgWidth - margin.left - margin.right,       
                        height = svgHeight - margin.top  - margin.bottom;
                    
                    // SVG Viewport
                    var svgViewport = d3.select("body").append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .style("border", "2px solid");
                    
                    // Scales
                    // var xAxisScale = d3.scale.linear()
                    //     .domain([0, width])
                    //     .range([0, width]);
                        var xAxisScale = d3.time.scale()
                        .domain(d3.extent(originalCircle, function (d) {
                            return d.cx; }))
                        .nice(d3.time.month)
                        .range([0, width]);
                    
                    var YVal = ["abc","xyz"];
                    var YDom = [5,10];
                    var yAxisScale = d3.scale.linear()
                        .domain([0,10])
                        .range([height, 0]);
                    // var yAxisScale = d3.scale.ordinal()
                    //     .domain(originalCircle.map(function(d) { return d.cy; }))
                    //     .rangeRoundBands([0, height]);
                
                    
                    // Axis Functions
                    var xAxis = d3.svg.axis()
                        .scale(xAxisScale)
                        .orient("bottom")
                        .ticks(5);
                    
                    var yAxis = d3.svg.axis()
                        .scale(yAxisScale)
                        .orient("left")
                        .tickValues(YDom)
                        .tickFormat(function(d,i){ return YVal[i] });
                      
                    
                    // Zoom Function Event Listener
                    function zoomFunction() {
  
                        // Select All Circles
                        var circles = d3.select("svg").selectAll("circle");
                    
                        // Pan Vector
                        var panVector = d3.event.translate;
                        var panX = panVector[0];
                        var panY = panVector[1];
                    
                        // Scaling Multiplier
                        var scaleMultiplier = d3.event.scale;
                    
                        // Tell us in HTML what is going on
                        d3.select("#pan_x_span").text(panX);
                        d3.select("#pan_y_span").text(panY);
                        d3.select("#v_scale_val").text(scaleMultiplier);
                    
                        // Redraw the Axis
                        innerSpace.select(".x.axis").call(xAxis);
                        //innerSpace.select(".y.axis").call(yAxis);
                    
                        // Redraw the Circle
                        circles
                            .attr("cx", function(d, i) { return xAxisScale(d.cx); });
                            //.attr("cy", function(d, i) { return yAxisScale(d.cy); })
                            //.attr("r",  function(d, i) { return (d.radius * scaleMultiplier); });    
                    }
                        
                    var zoom = d3.behavior.zoom()
                        .x(xAxisScale)
                        .y(yAxisScale)
                        .scaleExtent([0.2, 10])
                        .on("zoom", zoomFunction);  
                    
                    var innerSpace = svgViewport.append("g")
                        .attr("class", "inner_space")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                        .call(zoom);              
                                
                                
                    innerSpace.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis);
                    
                    innerSpace.append("g")
                        .attr("class", "y axis")
                        .call(yAxis);   
                        
                    var circle = innerSpace.selectAll("circle")
                        .data(originalCircle)
                      .enter().append("circle")
                        .attr("cx", function(d) { return xAxisScale(d.cx); })
                        .attr("cy", function(d) { return yAxisScale(d.cy); })
                        .attr("r",  function(d) { return d.radius; })
                        .style("fill", "green");    
                       
                    d3.select("body").append("div").attr("id", "pan_x_div").text("Pan X Translate: ");
                    d3.select("body").append("div").attr("id", "pan_y_div").text("Pan Y Translate: ");
                    d3.select("body").append("div").attr("id", "v_scale").text("D3 Zoom Scale: ");
                    
                    d3.select("#pan_x_div").append("span").attr("id", "pan_x_span");
                    d3.select("#pan_y_div").append("span").attr("id", "pan_y_span");
                    d3.select("#v_scale").append("span").attr("id", "v_scale_val"); 
                    
             };
            });
            
            
            
            $scope.func = function(){
                for(var d in pages.commits){
                    console.log(d);
                }
            };
            
            $scope.template = '';
            $scope.html = '';
            
            
            
        });
        
          	
            // samplesModule.factory('commitsInfo1Json', ['$http', function($http) { 
            // return $http.get('/app/data/commitsInfo1.json') 
            //     .success(function(data) { 
            //       return data; 
            //     }) 
            //     .error(function(err) { 
            //       return err; 
            //     }); 
            //*****************FACTORY*******************    
            samplesModule.factory('commitsJson', ['$http', function($http) { 
                return {
                    commits: $http.get('/app/data/commits.json')
                        .success(function(data) { 
                            return data; 
                        }) 
                        .error(function(err) { 
                              return err;
                        }),
                        
                    commitInfo: $http.get('/app/data/commitInfo.json')
                        .success(function(data) { 
                            return data; 
                        }) 
                        .error(function(err) { 
                              return err;
                    })
                };
            }]); 
                
             //*****************DIRECTIVE*******************
        
        // samplesModule.directive("commitTree", function(commitsJson, $scope, $routeParams){
        //   	function link(scope, element, attrs){
        //          var data = [1, 2, 3, 4, 5];

        //           var scale = d3.scale.linear()
        //             .domain([1, 5])   // Data space
        //             .range([0, 200]); // Pixel space
            
        //           var svg = d3.select("body").append("svg")
        //             .attr("width",  250)
        //             .attr("height", 250);
            
        //           svg.selectAll("rect")
        //               .data(data)
        //             .enter().append("rect")
        //               .attr("x", function (d){ return scale(d); })
        //               .attr("y", 50)
        //               .attr("width",  20)
        //               .attr("height", 20);    
        //     }
            
        //   	return{
        //       restrict: 'E',
        //       scope: {},
        //       //templateUrl: '/app/partials/commitInfo.html',
        //       link: link
        //   	};
        // });	    
                
        
    </script>
</body>
</html>
